<!doctype html>
<html lang="id" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Formulir Pendaftaran SMK</title>
  <script src="https://cdn.tailwindcss.com/3.4.17"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="/_sdk/data_sdk.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&amp;display=swap" rel="stylesheet">
  <style>
    * { font-family: 'Poppins', sans-serif; }
    
    .gradient-bg {
      background: linear-gradient(135deg, #1e3a5f 0%, #2d5a87 50%, #3d7ab5 100%);
    }
    
    .glass-card {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(20px);
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
    }
    
    .input-field {
      transition: all 0.3s ease;
      border: 2px solid #e2e8f0;
    }
    
    .input-field:focus {
      border-color: #3d7ab5;
      box-shadow: 0 0 0 4px rgba(61, 122, 181, 0.1);
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #1e3a5f 0%, #3d7ab5 100%);
      transition: all 0.3s ease;
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 25px -5px rgba(30, 58, 95, 0.4);
    }
    
    .btn-primary:disabled {
      opacity: 0.7;
      cursor: not-allowed;
      transform: none;
    }
    
    .radio-card {
      transition: all 0.2s ease;
    }
    
    .radio-card:hover {
      background: #f0f7ff;
    }
    
    .radio-card.selected {
      background: #e0f0ff;
      border-color: #3d7ab5;
    }
    
    .fade-in {
      animation: fadeIn 0.5s ease-out;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .success-animation {
      animation: successPulse 0.6s ease-out;
    }
    
    @keyframes successPulse {
      0% { transform: scale(0.8); opacity: 0; }
      50% { transform: scale(1.1); }
      100% { transform: scale(1); opacity: 1; }
    }
    
    .checkmark {
      animation: checkDraw 0.5s ease-out 0.3s forwards;
      stroke-dasharray: 100;
      stroke-dashoffset: 100;
    }
    
    @keyframes checkDraw {
      to { stroke-dashoffset: 0; }
    }
  </style>
  <style>body { box-sizing: border-box; }</style>
 </head>
 <body class="h-full">
  <div id="app-container" class="gradient-bg min-h-full w-full overflow-auto"><!-- Step 1: Registration Form -->
   <div id="step-registration" class="min-h-full flex items-center justify-center p-4 py-8">
    <div class="glass-card rounded-3xl p-8 w-full max-w-2xl fade-in">
     <div class="text-center mb-8">
      <div class="w-20 h-20 bg-gradient-to-br from-blue-900 to-blue-500 rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-lg">
       <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
       </svg>
      </div>
      <h1 id="form-title" class="text-3xl font-bold text-gray-800 mb-2">Formulir Pendaftaran</h1>
      <p id="school-name" class="text-gray-500 font-medium">SMK Negeri 1</p>
      <div class="flex justify-center gap-2 mt-4"><span class="w-10 h-1 bg-blue-600 rounded-full"></span> <span class="w-10 h-1 bg-gray-300 rounded-full"></span> <span class="w-10 h-1 bg-gray-300 rounded-full"></span>
      </div>
     </div>
     <form id="registration-form" class="space-y-5"><!-- Nama Lengkap -->
      <div><label for="nama_lengkap" class="block text-sm font-semibold text-gray-700 mb-2"> <span class="flex items-center gap-2">
         <svg class="w-4 h-4 text-blue-600" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
         </svg> Nama Lengkap </span> </label> <input type="text" id="nama_lengkap" name="nama_lengkap" required class="input-field w-full px-4 py-3 rounded-xl bg-gray-50 focus:bg-white outline-none" placeholder="Masukkan nama lengkap">
      </div><!-- Tempat & Tanggal Lahir -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
       <div><label for="tempat_lahir" class="block text-sm font-semibold text-gray-700 mb-2"> <span class="flex items-center gap-2">
          <svg class="w-4 h-4 text-blue-600" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
          </svg> Tempat Lahir </span> </label> <input type="text" id="tempat_lahir" name="tempat_lahir" required class="input-field w-full px-4 py-3 rounded-xl bg-gray-50 focus:bg-white outline-none" placeholder="Kota kelahiran">
       </div>
       <div><label for="tanggal_lahir" class="block text-sm font-semibold text-gray-700 mb-2"> <span class="flex items-center gap-2">
          <svg class="w-4 h-4 text-blue-600" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
          </svg> Tanggal Lahir </span> </label> <input type="date" id="tanggal_lahir" name="tanggal_lahir" required class="input-field w-full px-4 py-3 rounded-xl bg-gray-50 focus:bg-white outline-none">
       </div>
      </div><!-- Umur -->
      <div><label for="umur" class="block text-sm font-semibold text-gray-700 mb-2"> <span class="flex items-center gap-2">
         <svg class="w-4 h-4 text-blue-600" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 20l4-16m2 16l4-16M6 9h14M4 15h14"></path>
         </svg> Umur </span> </label> <input type="number" id="umur" name="umur" required min="10" max="25" class="input-field w-full px-4 py-3 rounded-xl bg-gray-50 focus:bg-white outline-none" placeholder="Umur dalam tahun">
      </div><!-- Jurusan -->
      <div><label class="block text-sm font-semibold text-gray-700 mb-3"> <span class="flex items-center gap-2">
         <svg class="w-4 h-4 text-blue-600" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"></path>
         </svg> Pilih Jurusan </span> </label>
       <div class="grid grid-cols-2 md:grid-cols-3 gap-3"><label class="radio-card cursor-pointer border-2 border-gray-200 rounded-xl p-4 text-center"> <input type="radio" name="jurusan" value="TKJ" class="hidden" required>
         <div class="text-2xl mb-1">
          üíª
         </div>
         <div class="font-semibold text-gray-800">
          TKJ
         </div>
         <div class="text-xs text-gray-500">
          Teknik Komputer Jaringan
         </div></label> <label class="radio-card cursor-pointer border-2 border-gray-200 rounded-xl p-4 text-center"> <input type="radio" name="jurusan" value="DKV" class="hidden">
         <div class="text-2xl mb-1">
          üé®
         </div>
         <div class="font-semibold text-gray-800">
          DKV
         </div>
         <div class="text-xs text-gray-500">
          Desain Komunikasi Visual
         </div></label> <label class="radio-card cursor-pointer border-2 border-gray-200 rounded-xl p-4 text-center"> <input type="radio" name="jurusan" value="AKL" class="hidden">
         <div class="text-2xl mb-1">
          üìä
         </div>
         <div class="font-semibold text-gray-800">
          AKL
         </div>
         <div class="text-xs text-gray-500">
          Akuntansi &amp; Keuangan
         </div></label> <label class="radio-card cursor-pointer border-2 border-gray-200 rounded-xl p-4 text-center"> <input type="radio" name="jurusan" value="ATP" class="hidden">
         <div class="text-2xl mb-1">
          üåæ
         </div>
         <div class="font-semibold text-gray-800">
          ATP
         </div>
         <div class="text-xs text-gray-500">
          Agribisnis Tanaman
         </div></label> <label class="radio-card cursor-pointer border-2 border-gray-200 rounded-xl p-4 text-center"> <input type="radio" name="jurusan" value="TKR" class="hidden">
         <div class="text-2xl mb-1">
          üîß
         </div>
         <div class="font-semibold text-gray-800">
          TKR
         </div>
         <div class="text-xs text-gray-500">
          Teknik Kendaraan Ringan
         </div></label> <label class="radio-card cursor-pointer border-2 border-gray-200 rounded-xl p-4 text-center"> <input type="radio" name="jurusan" value="TSM" class="hidden">
         <div class="text-2xl mb-1">
          üèçÔ∏è
         </div>
         <div class="font-semibold text-gray-800">
          TSM
         </div>
         <div class="text-xs text-gray-500">
          Teknik Sepeda Motor
         </div></label>
       </div>
      </div><!-- Jenis Kelamin -->
      <div><label class="block text-sm font-semibold text-gray-700 mb-3"> <span class="flex items-center gap-2">
         <svg class="w-4 h-4 text-blue-600" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"></path>
         </svg> Jenis Kelamin </span> </label>
       <div class="flex gap-4"><label class="radio-card flex-1 cursor-pointer border-2 border-gray-200 rounded-xl p-4 text-center"> <input type="radio" name="jenis_kelamin" value="Laki-laki" class="hidden" required>
         <div class="text-2xl mb-1">
          üë®
         </div>
         <div class="font-semibold text-gray-800">
          Laki-laki
         </div></label> <label class="radio-card flex-1 cursor-pointer border-2 border-gray-200 rounded-xl p-4 text-center"> <input type="radio" name="jenis_kelamin" value="Perempuan" class="hidden">
         <div class="text-2xl mb-1">
          üë©
         </div>
         <div class="font-semibold text-gray-800">
          Perempuan
         </div></label>
       </div>
      </div><!-- Hobi -->
      <div><label for="hobi" class="block text-sm font-semibold text-gray-700 mb-2"> <span class="flex items-center gap-2">
         <svg class="w-4 h-4 text-blue-600" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.828 14.828a4 4 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
         </svg> Hobi </span> </label> <input type="text" id="hobi" name="hobi" required class="input-field w-full px-4 py-3 rounded-xl bg-gray-50 focus:bg-white outline-none" placeholder="Contoh: Membaca, Olahraga, Gaming">
      </div><button type="submit" id="btn-next" class="btn-primary w-full py-4 rounded-xl text-white font-semibold text-lg flex items-center justify-center gap-2"> <span>Lanjutkan</span>
       <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"></path>
       </svg></button>
     </form>
    </div>
   </div><!-- Step 2: Login Form -->
   <div id="step-login" class="min-h-full flex items-center justify-center p-4 py-8 hidden">
    <div class="glass-card rounded-3xl p-8 w-full max-w-md fade-in">
     <div class="text-center mb-8">
      <div class="w-20 h-20 bg-gradient-to-br from-green-600 to-emerald-400 rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-lg">
       <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1"></path>
       </svg>
      </div>
      <h2 class="text-2xl font-bold text-gray-800 mb-2">Login Pendaftar</h2>
      <p class="text-gray-500">Masukkan data untuk melanjutkan</p>
      <div class="flex justify-center gap-2 mt-4"><span class="w-10 h-1 bg-green-500 rounded-full"></span> <span class="w-10 h-1 bg-green-500 rounded-full"></span> <span class="w-10 h-1 bg-gray-300 rounded-full"></span>
      </div>
     </div>
     <form id="login-form" class="space-y-5"><!-- Nama Lengkap -->
      <div><label for="login_nama" class="block text-sm font-semibold text-gray-700 mb-2"> <span class="flex items-center gap-2">
         <svg class="w-4 h-4 text-green-600" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
         </svg> Nama Lengkap </span> </label> <input type="text" id="login_nama" name="login_nama" required class="input-field w-full px-4 py-3 rounded-xl bg-gray-50 focus:bg-white outline-none" placeholder="Masukkan nama lengkap">
      </div><!-- Nomor HP -->
      <div><label for="nomor_hp" class="block text-sm font-semibold text-gray-700 mb-2"> <span class="flex items-center gap-2">
         <svg class="w-4 h-4 text-green-600" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path>
         </svg> Nomor HP </span> </label> <input type="tel" id="nomor_hp" name="nomor_hp" required class="input-field w-full px-4 py-3 rounded-xl bg-gray-50 focus:bg-white outline-none" placeholder="08xxxxxxxxxx">
      </div><!-- Email -->
      <div><label for="email" class="block text-sm font-semibold text-gray-700 mb-2"> <span class="flex items-center gap-2">
         <svg class="w-4 h-4 text-green-600" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
         </svg> Email </span> </label> <input type="email" id="email" name="email" required class="input-field w-full px-4 py-3 rounded-xl bg-gray-50 focus:bg-white outline-none" placeholder="contoh@email.com">
      </div><button type="submit" id="btn-login" class="w-full py-4 rounded-xl text-white font-semibold text-lg flex items-center justify-center gap-2" style="background: linear-gradient(135deg, #059669 0%, #10b981 100%);"> <span>Login</span>
       <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1"></path>
       </svg></button> <button type="button" id="btn-back" class="w-full py-3 rounded-xl text-gray-600 font-medium border-2 border-gray-200 hover:bg-gray-50 transition-colors flex items-center justify-center gap-2">
       <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 17l-5-5m0 0l5-5m-5 5h12"></path>
       </svg><span>Kembali</span> </button>
     </form>
    </div>
   </div><!-- Step 3: Success -->
   <div id="step-success" class="min-h-full flex items-center justify-center p-4 py-8 hidden">
    <div class="glass-card rounded-3xl p-10 w-full max-w-md text-center fade-in">
     <div class="success-animation">
      <div class="w-28 h-28 bg-gradient-to-br from-green-500 to-emerald-400 rounded-full flex items-center justify-center mx-auto mb-6 shadow-xl">
       <svg class="w-16 h-16 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path class="checkmark" stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path>
       </svg>
      </div>
     </div>
     <div class="flex justify-center gap-2 mb-6"><span class="w-10 h-1 bg-green-500 rounded-full"></span> <span class="w-10 h-1 bg-green-500 rounded-full"></span> <span class="w-10 h-1 bg-green-500 rounded-full"></span>
     </div>
     <h2 class="text-3xl font-bold text-gray-800 mb-3">Login Sukses! üéâ</h2>
     <p class="text-gray-500 mb-6">Selamat, pendaftaran Anda telah berhasil disimpan.</p>
     <div id="summary-card" class="bg-gradient-to-br from-gray-50 to-blue-50 rounded-2xl p-6 text-left mb-6">
      <h3 class="font-semibold text-gray-800 mb-4 flex items-center gap-2">
       <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
       </svg> Ringkasan Data</h3>
      <div id="summary-content" class="space-y-2 text-sm"><!-- Will be filled dynamically -->
      </div>
     </div><button type="button" id="btn-new" class="btn-primary w-full py-4 rounded-xl text-white font-semibold text-lg flex items-center justify-center gap-2">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
      </svg><span>Daftar Baru</span> </button>
    </div>
   </div>
  </div>
  <script>
    // Default configuration
    const defaultConfig = {
      form_title: 'Formulir Pendaftaran',
      school_name: 'SMK Negeri 1',
      primary_color: '#1e3a5f',
      secondary_color: '#3d7ab5',
      accent_color: '#059669',
      text_color: '#1f2937',
      background_color: '#f8fafc'
    };

    // Current registration data
    let currentRegistrationData = null;
    let allRecords = [];

    // Data handler for Data SDK
    const dataHandler = {
      onDataChanged(data) {
        allRecords = data;
        console.log('Data updated:', data.length, 'records');
      }
    };

    // Initialize SDKs
    async function initializeApp() {
      // Initialize Element SDK
      if (window.elementSdk) {
        window.elementSdk.init({
          defaultConfig,
          onConfigChange: async (config) => {
            const title = document.getElementById('form-title');
            const school = document.getElementById('school-name');
            
            if (title) title.textContent = config.form_title || defaultConfig.form_title;
            if (school) school.textContent = config.school_name || defaultConfig.school_name;
          },
          mapToCapabilities: (config) => ({
            recolorables: [
              {
                get: () => config.primary_color || defaultConfig.primary_color,
                set: (value) => {
                  config.primary_color = value;
                  window.elementSdk.setConfig({ primary_color: value });
                }
              },
              {
                get: () => config.secondary_color || defaultConfig.secondary_color,
                set: (value) => {
                  config.secondary_color = value;
                  window.elementSdk.setConfig({ secondary_color: value });
                }
              },
              {
                get: () => config.accent_color || defaultConfig.accent_color,
                set: (value) => {
                  config.accent_color = value;
                  window.elementSdk.setConfig({ accent_color: value });
                }
              }
            ],
            borderables: [],
            fontEditable: undefined,
            fontSizeable: undefined
          }),
          mapToEditPanelValues: (config) => new Map([
            ['form_title', config.form_title || defaultConfig.form_title],
            ['school_name', config.school_name || defaultConfig.school_name]
          ])
        });
      }

      // Initialize Data SDK
      if (window.dataSdk) {
        const initResult = await window.dataSdk.init(dataHandler);
        if (!initResult.isOk) {
          console.error('Failed to initialize Data SDK');
        }
      }

      // Setup form handlers
      setupFormHandlers();
    }

    function setupFormHandlers() {
      // Radio card selection styling
      document.querySelectorAll('.radio-card').forEach(card => {
        card.addEventListener('click', function() {
          const name = this.querySelector('input').name;
          document.querySelectorAll(`input[name="${name}"]`).forEach(input => {
            input.closest('.radio-card').classList.remove('selected');
          });
          this.classList.add('selected');
        });
      });

      // Registration form submission
      const registrationForm = document.getElementById('registration-form');
      registrationForm.addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const formData = new FormData(this);
        currentRegistrationData = {
          nama_lengkap: formData.get('nama_lengkap'),
          tempat_lahir: formData.get('tempat_lahir'),
          tanggal_lahir: formData.get('tanggal_lahir'),
          umur: parseInt(formData.get('umur')),
          jurusan: formData.get('jurusan'),
          jenis_kelamin: formData.get('jenis_kelamin'),
          hobi: formData.get('hobi')
        };

        // Go to login step
        showStep('login');
        
        // Pre-fill login name
        document.getElementById('login_nama').value = currentRegistrationData.nama_lengkap;
      });

      // Login form submission
      const loginForm = document.getElementById('login-form');
      loginForm.addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const btn = document.getElementById('btn-login');
        btn.disabled = true;
        btn.innerHTML = '<svg class="animate-spin w-5 h-5 mr-2" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"></path></svg> Memproses...';

        const formData = new FormData(this);
        
        // Combine all data
        const fullData = {
          ...currentRegistrationData,
          nomor_hp: formData.get('nomor_hp'),
          email: formData.get('email'),
          created_at: new Date().toISOString()
        };

        // Check limit
        if (allRecords.length >= 999) {
          btn.disabled = false;
          btn.innerHTML = '<span>Login</span><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1"></path></svg>';
          showError('Batas maksimal 999 pendaftar telah tercapai.');
          return;
        }

        // Save to Data SDK
        if (window.dataSdk) {
          const result = await window.dataSdk.create(fullData);
          
          if (result.isOk) {
            showSuccess(fullData);
          } else {
            btn.disabled = false;
            btn.innerHTML = '<span>Login</span><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1"></path></svg>';
            showError('Gagal menyimpan data. Silakan coba lagi.');
          }
        } else {
          // If no Data SDK, just show success
          showSuccess(fullData);
        }
      });

      // Back button
      document.getElementById('btn-back').addEventListener('click', function() {
        showStep('registration');
      });

      // New registration button
      document.getElementById('btn-new').addEventListener('click', function() {
        resetForms();
        showStep('registration');
      });
    }

    function showStep(step) {
      const steps = ['registration', 'login', 'success'];
      steps.forEach(s => {
        const el = document.getElementById(`step-${s}`);
        if (el) {
          el.classList.add('hidden');
        }
      });
      
      const targetStep = document.getElementById(`step-${step}`);
      if (targetStep) {
        targetStep.classList.remove('hidden');
        targetStep.querySelector('.glass-card')?.classList.add('fade-in');
      }
    }

    function showSuccess(data) {
      // Update summary content
      const summaryContent = document.getElementById('summary-content');
      summaryContent.innerHTML = `
        <div class="flex justify-between py-1 border-b border-gray-200">
          <span class="text-gray-500">Nama:</span>
          <span class="font-medium text-gray-800">${data.nama_lengkap}</span>
        </div>
        <div class="flex justify-between py-1 border-b border-gray-200">
          <span class="text-gray-500">TTL:</span>
          <span class="font-medium text-gray-800">${data.tempat_lahir}, ${formatDate(data.tanggal_lahir)}</span>
        </div>
        <div class="flex justify-between py-1 border-b border-gray-200">
          <span class="text-gray-500">Umur:</span>
          <span class="font-medium text-gray-800">${data.umur} tahun</span>
        </div>
        <div class="flex justify-between py-1 border-b border-gray-200">
          <span class="text-gray-500">Jurusan:</span>
          <span class="font-medium text-gray-800">${data.jurusan}</span>
        </div>
        <div class="flex justify-between py-1 border-b border-gray-200">
          <span class="text-gray-500">Jenis Kelamin:</span>
          <span class="font-medium text-gray-800">${data.jenis_kelamin}</span>
        </div>
        <div class="flex justify-between py-1 border-b border-gray-200">
          <span class="text-gray-500">Hobi:</span>
          <span class="font-medium text-gray-800">${data.hobi}</span>
        </div>
        <div class="flex justify-between py-1 border-b border-gray-200">
          <span class="text-gray-500">No. HP:</span>
          <span class="font-medium text-gray-800">${data.nomor_hp}</span>
        </div>
        <div class="flex justify-between py-1">
          <span class="text-gray-500">Email:</span>
          <span class="font-medium text-gray-800">${data.email}</span>
        </div>
      `;
      
      showStep('success');
    }

    function showError(message) {
      // Create inline error message
      const loginForm = document.getElementById('login-form');
      const existingError = loginForm.querySelector('.error-message');
      if (existingError) existingError.remove();
      
      const errorDiv = document.createElement('div');
      errorDiv.className = 'error-message bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-xl mb-4 text-sm flex items-center gap-2';
      errorDiv.innerHTML = `
        <svg class="w-5 h-5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
        </svg>
        <span>${message}</span>
      `;
      loginForm.insertBefore(errorDiv, loginForm.firstChild);
      
      setTimeout(() => errorDiv.remove(), 5000);
    }

    function formatDate(dateStr) {
      const date = new Date(dateStr);
      const options = { day: 'numeric', month: 'long', year: 'numeric' };
      return date.toLocaleDateString('id-ID', options);
    }

    function resetForms() {
      document.getElementById('registration-form').reset();
      document.getElementById('login-form').reset();
      document.querySelectorAll('.radio-card').forEach(card => {
        card.classList.remove('selected');
      });
      currentRegistrationData = null;
      
      // Reset login button
      const btn = document.getElementById('btn-login');
      btn.disabled = false;
      btn.innerHTML = '<span>Login</span><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1"></path></svg>';
    }

    // Initialize app
    initializeApp();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9d381d0d32321d1c',t:'MTc3MjAzMjA1OS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>